
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Document:      DM  Doc Tree
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass{article}

\usepackage{times,layouts}
\usepackage{tikz,hyperref,amsmath}
\usetikzlibrary{positioning,arrows,shapes,decorations.shapes,shapes.arrows}
\usetikzlibrary{backgrounds,calc}

\usepackage[paperwidth=39cm,paperheight=22cm,
left=-2mm,top=3mm,bottom=0mm,right=0mm,
noheadfoot,marginparwidth=0pt,includemp=false
]{geometry}


\newcommand\showpage{%
\setlayoutscale{0.5}\setlabelfont{\tiny}\printheadingsfalse\printparametersfalse
\currentpage\pagedesign}

\hypersetup{pdftitle={DM doc tree }, pdfsubject={Documentation tree for LSST DM }, pdfauthor={ William O'Mullane}}

\input{styles}


\begin{document}

\begin{tikzpicture}[node distance=0mm]


    \node (oss) [docbox ] { Observatory System Spec LSE-30 (OSS) };
	\node (daicd) [docboxicd, left=11cm of oss] { DM Data Acq ICD LSE-68 };
	\node (camicd) [docboxicd, above=0.2cm of daicd] { DM Camera ICD LSE-69 };
	\node (csicd) [docboxicd, above=0.2cm of camicd] { DM Telescope Control Sys ICD LSE-75 };
	\node (sumicd) [docboxicd, above=0.2cm of csicd] { DM Summit Infra ICD LSE-76 };
	\node (baseicd) [docboxicd, above=0.2cm of sumicd] { DM Base Infra ICD LSE-77 };
	\node (epoicd) [docboxicd, above=0.2cm of baseicd] { DM EPO ICD LSE-131 };
	\node (auxicd) [docboxicd, above=0.2cm of epoicd] { DM Telescope Aux  ICD LSE-140 };
    \node (lsr) [docbox, right = 1cm of oss] { LSST  System Requirements LSE-29 (LSR)};
	\node (srd) [docbox, right = 1cm of lsr] { LSST  Science Requirements LPM-17 (SRD)};
%  LEGEND
	\node(legend) [below=1cm of oss] {};
	\node(legendr) [right=1cm of legend] {};
	\draw[dline] (legend) to (legendr);
	\node(dtext) [right= 2mm of legendr] {Specification and Design};
	\node(legend2) [below=2mm of legend] {};
	\node(legend2r) [right=1cm of legend2] {};
	\draw[pline] (legend2) to (legend2r);
	\node(ptext) [right= 2mm of legend2r] {Planning};
	\node(legend3) [below=2mm of legend2] {};
	\node(legend3r) [right=1cm of legend3] {};
	\draw[tline] (legend3) to (legend3r);
	\node(ttext) [right= 2mm of legend3r] {Test and Validation};
        \node (nf) [docboxm, left=5mm of legend2] { Coming in 2018};
	\node (icd) [docboxicd, left=5mm of nf] { Interface Control Document (ICD) };
	\node (upd) [docboxu, left=5mm of icd] { Needs Update};
%%%
	\node (srp) [above=15mm of oss.north] {};
	\node (dmsr) [docbox, left=3mm of srp] { DM System Requirements  LSE-61 (DMSR)};
	\node (dmsrp) [left=20 mm of dmsr] {};
	\node (dqap) [docbox, below=7mm of dmsrp] { LSST Data Quality Assurance Plan LSE-63 (DQAP)};
	\node (dpdd) [docbox, right=2mm of srp] { LSST Data Products  LSE-163 (DPDD)};
	\node (svtp) [docbox, left=44mm of dmsr.west] { DM  Validation \& Test Plan LDM-503 (SVTP)};
    \node (pmp) [docbox, right=47mm of dpdd.east] { DM PMP LDM-294};
    \node (pmpp) [above=20mm of pmp] {};
    \node (crd) [docboxm, text width=38mm,  right=67mm of pmp.east] {Config/Release/Deploy Management };
    \node (vcd) [docboxm, above=5mm of crd.north] { DM Verification Control (VCD)};

    %\node (compz) [docboxm, above=5mm of dmsr.north] { Component Z Requirements LDM-XXX};
    %\node (compx) [docboxm, left=20mm of compz] { Component X Requirements LDM-XXX};
    %\node (crdots) [right=1mm of compx.east] {\huge \ldots \ldots};
    \node (compd)  [docbox, left=13mm of pmpp] { Component Architecture  LDM-148};
%LDM-154, DB LDM-155, Middleware LDM-156%%
%%%%%% REQUIREMENTS %%%%%
    \node (scipr) [docbox, left=30mm of compd] { Science Platform Requirements LDM-554};
    \node (mwr) [docbox, left=5mm of scipr] { Middleware Requirements LDM-556};
    \node (dbr) [docbox, left=5mm of mwr] { Database Requirements LDM-555};

    \node (scipc) [docbox, above=10mm of scipr] { Science Platform Design LDM-542};
   % \node (suitc) [docboxu, above=5mm of scipc] { SUIT Design LDM-131};
    \node (mwc)  [docbox, left=5mm of scipc] { Middleware Design LDM-152};
    \node (dbc)  [docbox, left=5mm of mwc] { Database  Design LDM-135};
    \node (infrac)  [docboxu, right=5mm of scipc] { Services \& Infrastructure LDM-129};
    \node (plc)  [docbox, right=5mm of infrac.east] {Pipeline Design LDM-151};
    \node (netc) [docbox, right=5mm of plc.east] { Network Design LSE-78};
    \node (userd)  [docbox, right=45mm of compd] { User Documentation };

    %%%%%%%%%%% TEST SPECS %%%%%%%%%%%%%%
    \node (ncsaenct) [docboxm, above=22mm of auxicd ] { NCSA Enclave Test Spec LDM-532};
    \node (baseenct) [docboxm, right=7mm of ncsaenct] { Base Enclave Test Spec LDM-538};
    \node (ccenct) [docboxm, right =7mm of baseenct ] { Comm Cluster Test Spec LDM-541};


    \node (dbbt) [docboxm, right =7mm of ccenct ] { Data BackBone  Test Spec LDM-535 };

    \node (datast) [docboxm, right=7mm of dbbt] { Data Services Test Spec LDM-536};

    \node (scipt) [docboxm, right=7mm of datast] {Science Platform  Test Spec LDM-540 };
    \node (l1t) [docboxm, right=7mm of scipt] { L1 Test Spec LDM-533 };
    \node (l2t) [docbox, right=7mm of l1t] { L2 Test Spec  LDM-534};
    \node (infrat) [docboxm, right=7mm of l2t] { DBB Infrastructure  Test Spec LDM-537};

  %%%%%%%%%% component tests %%%%%%%%%%%%%%%%%%%

    \node (l2kpm) [docbox, above=5mm of l2t] { L2 KPMs  LDM-502};
    \node (qservt) [docbox, above=5mm of dbbt] { Qserv test spec LDM-552 } ;

  %%%%%%%%%% test reports %%%%%%%%%%%%%%%%%%%

    \node (l2tr) [docbox, above=25mm of l2t] { L2 Test Reports };
    \node (ncsaenctr) [docboxm, above=25mm of ncsaenct] { NCSA Enclave Test Reports };
    \node (baseenctr) [docboxm, above=25mm of baseenct] { Base Enclave Test Reports };
    \node (ccenctr) [docboxm, above=25mm of ccenct] {Comm Cluster Test Reports };

    \node (dbbtr) [docbox, above=25mm of dbbt] { DBB Test Reports };
    \node (datastr) [docboxm, above=25mm of datast] { Data Services Test Reports };
    \node (sciptr) [docboxm, above=25mm of scipt] { Science Platform Test Reports };
    \node (l1tr) [docboxm, above=25mm of l1t] { L1 Test Reports };
    \node (infratr) [docbox, above=25mm of infrat] { Infrastructure Test Reports };

   \draw[dline] (dmsr.north)  ++(0,0.6) -| (compd.south);
   \draw[dline] (dmsr.north) -- ++(0,0.6) -| (dbr.south);
   \node (sciprp) [below=0.85 of scipr] {};
   \draw[dline] (sciprp) to  (scipr.south);
   \node (mwrp) [below=0.85 of mwr] {};
   \draw[dline] (mwrp) to (mwr.south);

   %%% DESSIGN LINES %%%%
   \draw[dline] (dbr.north)  ++(-0.3,0.0) --  (dbc.south);
   \draw[dline] (mwr.north)  ++(-0.3,0.0) --  (mwc.south);
   \draw[dline] (scipr.north)  ++(-0.3,0.0) --  (scipc.south);

   \draw[dline] (dpdd.west) to (dmsr.east);
   \draw[dline]   (oss.west) ++(-0.2,0)   |- (dqap.east);
   \draw[dline] (lsr.north) -- ++(0.0,0.5) -| (dmsr.south);
   %\draw[dline] (dpdd.south)to (oss.north);
   \draw[dlines] (oss.north) -- ++(0,0.5); % (dmsr.south);
   \draw[dline] (lsr.west) to (oss.east)  ;
   \draw[dline] (srd.west) to (lsr.east) ;
   \draw[dline] (srd.north) ++(-1.1,0)  |- (dpdd.east) ;


   \node (scipcp) [below=5mm of scipc] {};
   \draw[dline] (scipcp.north) to (scipc.south);
   \draw[dline] (scipcp.north) -| (netc.south);

   \node (plcp) [below=5mm of plc] {};
   \draw[dline] (plcp.north) to (plc.south);

   \node (mwcp) [below=5mm of mwc] {};
   \draw[dline] (mwcp.north) to  (mwc.south);

   \node (infracp) [below=5mm of infrac] {};
   \draw[dline] (infracp.north) -| (infrac.south);

   \node (dbcp) [below=5mm of dbc] {};
   \draw[dline] (dbcp.north) to (dbc.south);

   \draw[dlines] (plcp.north) -- (dbcp.north);
   \draw[dlines] (scipcp.north) -- (plcp.north);
   \draw[dlines] (compd.north) -- (plcp.north);


   \node (ccenctp) [left=3mm of ccenct] {};
   \node (ccenctpb) [below=10mm of ccenctp.east] {};
   \draw[dline] (ccenctpb.west) |- (ccenct.west);

   \node (baseenctp) [left=3mm of baseenct] {};
   \node (baseenctpb) [below=10mm of baseenctp.east] {};
   \draw[dline] (baseenctpb.west) |-  (baseenct.west);

   \node (datastp) [left=3mm of datast] {};
   \node (datastpb) [below=10mm of datastp.east] {};
   \draw[dline] (datastpb.west) |- (datast.west);

   \node (infratp) [left=3mm of infrat] {};
   \node (infratpb) [below=10mm of infratp.east] {};
   \draw[dline] (infratpb.west) |- (infrat.west);

   \node (pltp) [left=3mm of l2t] {};
   \node (pltpb) [below=10mm of pltp.east] {};
   \draw[dline] (pltpb.west) |- (l2t.west);

    %\node (tst) [below=5mm of pltpb] {\color{red} Draft Component test specs};

   \node (sciptp) [left=3mm of scipt] {};
   \node (sciptb) [below=10mm of sciptp.east] {};
   \draw[dline] (sciptb.west) |-  (scipt.west);

   \node (l1tp) [left=3mm of l1t] {};
   \node (l1tpb) [below=10mm of l1tp.east] {};
   \draw[dline] (l1tpb.west) |-  (l1t.west);

   \node (l2tp) [left=3mm of l2t] {};
   \node (l2tpb) [below=10mm of l2tp.east] {};
   \draw[dline] (l2tpb.west) |-  (l2t.west);

   \node (dbbtp) [left=3mm of dbbt] {};
   \node (dbbtpb) [below=10mm of dbbtp.east] {};
   \draw[dline] (dbbtpb.west) |-  (dbbt.west);

   \node (ncsaenctp) [left=3mm of ncsaenct] {};
   \node (ncsaenctpb) [below=10mm of ncsaenctp.east] {};
   \draw[dline] (ncsaenctpb.west) |-  (ncsaenct.west);
%long line for test specs
   \node (baseenctp2) [left=-8mm of baseenct] {};
   \node (baseenctpb2) [below=10mm of baseenct.center] {};
   \draw[dlines] (baseenctpb2.west) -- (infratpb.west);
   \draw[dlines] (baseenctpb2.west) -- (ncsaenctpb.west);
   \draw[dlines] (svtp.north) |- (baseenctpb2.west);




   \draw[tlines] (baseenctr.north) -- ++(0,0.6);
   \draw[tlines] (ccenctr.north) -- ++(0,0.6);
   \draw[tlines] (datastr.north) -- ++(0,0.6);
   \draw[tlines] (sciptr.north) -- ++(0,0.6);
   \draw[tlines] (l1tr.north) -- ++(0,0.6);
   \draw[tlines] (l2tr.north) -- ++(0,0.6);
   \draw[tlines] (dbbtr.north) -- ++(0,0.6);
   \draw[tlines] (infratr.north) -- ++(0,0.6);
   \draw[tlines] (infratr.north) -- ++(0,0.6);

   %\node(ncsaenctrp) [above=4mm of ncsaenctr]{};
   %\draw[tlines] (ncsaenctr.north) -- (ncsaenctrp.north);
   %\draw[tline] (ncsaenctrp.north)   -| (vcd.north);
   \draw[tline] (ncsaenctr.north) -- ++(0,0.6)  -| (vcd.north);

   \draw[tline] (svtp.east) to (dmsr.west);
   \draw[tline] (l2t.south) to (plc.north);
   \draw[tline] (l1t.south) to (plc.north);
   \draw[tline] (infrat.south) to (netc.north);

   \draw[tline] (datast.south) to (dbc.north);
   \draw[tline] (scipt.south) to (scipc.north);
%reports
   \draw[dline] (infrat.north) to (infratr.south);
   \draw[dline] (l2t.north) to (l2tr.south);
   \draw[dline] (l1t.north) to (l1tr.south);
   \draw[dline] (datast.north) to (datastr.south);
   \draw[dline] (scipt.north) to (sciptr.south);
   \draw[dline] (ncsaenct.north) to (ncsaenctr.south);
   \draw[dline] (baseenct.north) to (baseenctr.south);
   \draw[dline] (ccenct.north) to (ccenctr.south);
   \draw[dline] (dbbt.north) to (dbbtr.south);

   \draw[pline] (pmp.north) |-  (compd.east);
   \draw[pline] (pmp.north) |-  (userd.west);
   \draw[pline] (pmp.east) -- (vcd.west);
   \draw[pline] (pmp.east) -|  (crd.west);

 %icds
   \node (daicdp) [right=0.8cm of daicd.east] {};
   \draw[dline] (daicdp.west) -- (daicd.east);

   \node (camicdp) [right=0.8cm of camicd.east] {};
   \draw[dline] (camicdp.west) -- (camicd.east);
   \node (csicdp) [right=0.8cm of csicd.east] {};
   \draw[dline] (csicdp.west) -- (csicd.east);
   \node (sumicdp) [right=0.8cm of sumicd.east] {};
   \draw[dline] (sumicdp.west) -- (sumicd.east);

   \node (baseicdp) [right=0.8cm of baseicd.east] {};
   \draw[dline] (baseicdp.west) -- (baseicd.east);

   \node (epoicdp) [right=0.8cm of epoicd.east] {};
   \draw[dline] (epoicdp.west) -- (epoicd.east);


   \node (auxicdp) [right=0.8cm of auxicd.east] {};
   \draw[dlines] (oss.west) -| (auxicdp.west);
   \draw[dline] (auxicdp.west) -- (auxicd.east);

\end{tikzpicture}
\end{document}
